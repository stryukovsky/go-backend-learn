<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Uniswap V3 Activity Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: monospace;
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        color: white;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
      }

      .card h2 {
        color: #2d3748;
        margin-bottom: 20px;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .select-wrapper {
        position: relative;
        margin-bottom: 20px;
      }

      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .wallet-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
      }

      .wallet-item {
        padding: 16px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f8fafc;
      }

      .wallet-item:hover {
        border-color: #667eea;
        background: #f1f5f9;
        transform: translateY(-1px);
      }

      .wallet-item.selected {
        border-color: #667eea;
        background: #ebf4ff;
      }

      .wallet-address {
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        color: #4a5568;
        word-break: break-all;
        margin-bottom: 8px;
      }

      .wallet-info {
        font-size: 0.85rem;
        color: #718096;
      }

      .activity-section {
        margin-top: 30px;
      }

      .activity-table {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-top: 20px;
      }

      .activity-column {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        min-height: 400px;
      }

      .activity-column-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e2e8f0;
      }

      .activity-column-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
      }

      .activity-count {
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 16px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .activity-column.swap .activity-count {
        background: #48bb78;
      }

      .activity-column.mint .activity-count {
        background: #4299e1;
      }

      .activity-column.burn .activity-count {
        background: #ed8936;
      }

      .activity-column.collect .activity-count {
        background: #9f7aea;
      }

      .activity-list {
        max-height: 360px;
        overflow-y: auto;
        padding-right: 8px;
      }

      .activity-list::-webkit-scrollbar {
        width: 6px;
      }

      .activity-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }

      .activity-list::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 3px;
      }

      .activity-list::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }

      .activity-item {
        padding: 14px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        border-left: 4px solid transparent;
      }

      .activity-item:hover {
        border-color: #667eea;
        border-left-color: #667eea;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .activity-column.swap .activity-item {
        border-left-color: #48bb78;
      }

      .activity-column.mint .activity-item {
        border-left-color: #4299e1;
      }

      .activity-column.burn .activity-item {
        border-left-color: #ed8936;
      }

      .activity-column.collect .activity-item {
        border-left-color: #9f7aea;
      }

      .activity-column.swap .activity-item:hover {
        border-left-color: #38a169;
      }

      .activity-column.mint .activity-item:hover {
        border-left-color: #3182ce;
      }

      .activity-column.burn .activity-item:hover {
        border-left-color: #dd6b20;
      }

      .activity-column.collect .activity-item:hover {
        border-left-color: #805ad5;
      }

      .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .activity-price {
        font-size: 1rem;
        font-weight: 600;
        color: #2d3748;
      }

      .activity-volume {
        font-size: 0.85rem;
        color: #718096;
        margin-top: 4px;
      }

      .activity-details {
        font-size: 0.8rem;
        color: #a0aec0;
        margin-top: 4px;
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 16px;
        max-width: 900px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #718096;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        font-weight: 600;
        color: #4a5568;
      }

      .detail-value {
        color: #2d3748;
        font-family: "Courier New", monospace;
        word-break: break-all;
        text-align: right;
        max-width: 60%;
      }

      .detail-value.positive {
        color: #48bb78;
      }

      .detail-value.negative {
        color: #f56565;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #718096;
      }

      .spinner {
        display: inline-block;
        width: 32px;
        height: 32px;
        border: 3px solid #e2e8f0;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .error {
        background: #fed7d7;
        color: #c53030;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: #718096;
        font-style: italic;
      }

      @media (max-width: 1200px) {
        .activity-table {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .wallet-list {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .activity-table {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .activity-column {
          min-height: 300px;
        }

        .modal-content {
          width: 95%;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <div class="header">
          <h1>ðŸ¦„ Uniswap V3 Activity Dashboard</h1>
          <p>Monitor your Uniswap V3 swaps, mints, burns, and collects</p>
        </div>

        <!-- Error Display -->
        <div v-if="error" class="error">{{ error }}</div>

        <!-- Step 1: Chain Selection -->
        <div class="card">
          <h2>ðŸ“Š Select Blockchain</h2>
          <div class="select-wrapper">
            <select v-model="selectedChain" @change="onChainSelect">
              <option value="">Choose a blockchain...</option>
              <option
                v-for="chain in chains"
                :key="chain.ChainId"
                :value="chain"
              >
                {{ chain.name }} (ID: {{ chain.ChainId }})
              </option>
            </select>
          </div>
        </div>

        <!-- Step 2: Wallet Selection -->
        <div v-if="selectedChain && wallets.length > 0" class="card">
          <h2>ðŸ’¼ Your Wallets on {{ selectedChain.name }}</h2>
          <div class="wallet-list">
            <div
              v-for="wallet in wallets"
              :key="wallet.address"
              class="wallet-item"
              :class="{ selected: selectedWallet?.address === wallet.address }"
              @click="selectWallet(wallet)"
            >
              <div class="wallet-address">{{ wallet.address }}</div>
              <div class="wallet-info">Last Block: {{ wallet.lastBlock }}</div>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div v-if="loading" class="card">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading...</p>
          </div>
        </div>

        <!-- Activity Display -->
        <div v-if="selectedWallet && activities" class="card activity-section">
          <h2>ðŸ“Š Activity Overview</h2>
          <div class="activity-table">
            <!-- Swap Column -->
            <div class="activity-column swap">
              <div class="activity-column-header">
                <div class="activity-column-title">ðŸ”„ Swap</div>
                <div class="activity-count">{{ swapActivities.length }}</div>
              </div>
              <div class="activity-list">
                <div v-if="swapActivities.length === 0" class="empty-state">
                  No swap activities found
                </div>
                <div
                  v-else
                  v-for="activity in swapActivities"
                  :key="'swap-' + activity.ID"
                  class="activity-item"
                  @click="showActivityDetails(activity)"
                >
                  <div class="activity-header">
                    <div class="activity-price">
                      ${{ Math.max(activity.volumeTokensAInUSD,
                      activity.volumeTokensBInUSD) }}
                    </div>
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolA}}: {{
                    formatAmount(activity.volumeTokensAInUSD) }}
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolB}}: {{
                    formatAmount(activity.volumeTokensBInUSD) }}
                  </div>
                  <div class="activity-details">
                    {{ formatDate(activity.blockchainEvent.timestamp) }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Mint Column -->
            <div class="activity-column mint">
              <div class="activity-column-header">
                <div class="activity-column-title">âž• Mint</div>
                <div class="activity-count">{{ mintActivities.length }}</div>
              </div>
              <div class="activity-list">
                <div v-if="mintActivities.length === 0" class="empty-state">
                  No mint activities found
                </div>
                <div
                  v-else
                  v-for="activity in mintActivities"
                  :key="'mint-' + activity.ID"
                  class="activity-item"
                  @click="showActivityDetails(activity)"
                >
                  <div class="activity-header">
                    <div class="activity-price">
                      ${{ activity.volumeTotalUSD }}
                    </div>
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolA}}: {{
                    formatAmount(activity.volumeTokensAInUSD) }}
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolB}}: {{
                    formatAmount(activity.volumeTokensBInUSD) }}
                  </div>
                  <div class="activity-details">
                    {{ formatDate(activity.blockchainEvent.timestamp) }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Burn Column -->
            <div class="activity-column burn">
              <div class="activity-column-header">
                <div class="activity-column-title">ðŸ”¥ Burn</div>
                <div class="activity-count">{{ burnActivities.length }}</div>
              </div>
              <div class="activity-list">
                <div v-if="burnActivities.length === 0" class="empty-state">
                  No burn activities found
                </div>
                <div
                  v-else
                  v-for="activity in burnActivities"
                  :key="'burn-' + activity.ID"
                  class="activity-item"
                  @click="showActivityDetails(activity)"
                >
                  <div class="activity-header">
                    <div class="activity-price">
                      ${{ activity.volumeTotalUSD }}
                    </div>
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolA}}: {{
                    formatAmount(activity.volumeTokensAInUSD) }}
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolB}}: {{
                    formatAmount(activity.volumeTokensBInUSD) }}
                  </div>
                  <div class="activity-details">
                    {{ formatDate(activity.blockchainEvent.timestamp) }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Collect Column -->
            <div class="activity-column collect">
              <div class="activity-column-header">
                <div class="activity-column-title">ðŸ’° Collect</div>
                <div class="activity-count">{{ collectActivities.length }}</div>
              </div>
              <div class="activity-list">
                <div v-if="collectActivities.length === 0" class="empty-state">
                  No collect activities found
                </div>
                <div
                  v-else
                  v-for="activity in collectActivities"
                  :key="'collect-' + activity.ID"
                  class="activity-item"
                  @click="showActivityDetails(activity)"
                >
                  <div class="activity-header">
                    <div class="activity-price">
                      ${{ activity.volumeTotalUSD }}
                    </div>
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolA}}: {{
                    formatAmount(activity.volumeTokensAInUSD) }}
                  </div>
                  <div class="activity-volume">
                    {{activity.symbolB}}: {{
                    formatAmount(activity.volumeTokensBInUSD) }}
                  </div>
                  <div class="activity-details">
                    {{ formatDate(activity.blockchainEvent.timestamp) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Details Modal -->
      <div
        v-if="selectedActivity"
        class="modal"
        @click.self="closeActivityDetails"
      >
        <div class="modal-content">
          <button class="modal-close" @click="closeActivityDetails">
            &times;
          </button>
          <h2>ðŸ“‹ {{ selectedActivity.blockchainEvent.type }} Details</h2>

          <h3 style="margin: 20px 0 10px 0">ðŸ’µ Financial Summary</h3>
          <div class="detail-row">
            <span class="detail-label">Activity ID:</span>
            <span class="detail-value">{{ selectedActivity.ID }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Price {{selectedActivity.symbolA}}:</span>
            <span class="detail-value"
              >${{ selectedActivity.priceTokenA }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Price {{selectedActivity.symbolB}}:</span>
            <span class="detail-value"
              >${{ selectedActivity.priceTokenB }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Volume {{selectedActivity.symbolA}} (USD):</span>
            <span
              class="detail-value"
              :class="
                getAmountClass(selectedActivity.volumeTokensAInUSD)
              "
              >${{ selectedActivity.volumeTokensAInUSD }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Volume {{selectedActivity.symbolB}} (USD):</span>
            <span
              class="detail-value"
              :class="
                getAmountClass(selectedActivity.volumeTokensBInUSD)
              "
              >${{ selectedActivity.volumeTokensBInUSD }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Total Volume (USD):</span>
            <span
              class="detail-value"
              :class="getAmountClass(selectedActivity.volumeTotalUSD)"
              >${{ selectedActivity.volumeTotalUSD }}</span
            >
          </div>

          <h3 style="margin: 20px 0 10px 0">ðŸ”— Blockchain Event</h3>
          <div class="detail-row">
            <span class="detail-label">Event Type:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.type }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Chain ID:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.chainId }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Wallet Address:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.walletAddress }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Pool Address:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.poolAddress }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount {{selectedActivity.symbolA}}:</span>
            <span
              class="detail-value"
              :class="
                getAmountClass(selectedActivity.blockchainEvent.amountTokenA)
              "
              >{{ selectedActivity.volumeTokensA}}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Amount {{selectedActivity.symbolB}}:</span>
            <span
              class="detail-value"
              :class="
                getAmountClass(selectedActivity.blockchainEvent.amountTokenB)
              "
              >{{ selectedActivity.volumeTokensB}}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Price Lower:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.priceLower }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Price Upper:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.priceUpper }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Transaction ID:</span>
            <span class="detail-value"
              >{{ selectedActivity.blockchainEvent.txId }}</span
            >
          </div>
          <div class="detail-row">
            <span class="detail-label">Timestamp:</span>
            <span class="detail-value"
              >{{ formatDate(selectedActivity.blockchainEvent.timestamp)
              }}</span
            >
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            chains: [],
            selectedChain: "",
            wallets: [],
            selectedWallet: null,
            activities: null,
            selectedActivity: null,
            loading: false,
            error: null,
            apiBaseUrl: "http://localhost:8080",
          };
        },

        computed: {
          swapActivities() {
            if (!this.activities) return [];
            return this.activities.filter(
              (activity) =>
                activity.blockchainEvent.type.toLowerCase() === "swap",
            );
          },

          mintActivities() {
            if (!this.activities) return [];
            return this.activities.filter(
              (activity) =>
                activity.blockchainEvent.type.toLowerCase() === "mint",
            );
          },

          burnActivities() {
            if (!this.activities) return [];
            return this.activities.filter(
              (activity) =>
                activity.blockchainEvent.type.toLowerCase() === "burn",
            );
          },

          collectActivities() {
            if (!this.activities) return [];
            return this.activities.filter(
              (activity) =>
                activity.blockchainEvent.type.toLowerCase() === "collect",
            );
          },
        },

        async mounted() {
          await this.loadChains();
        },

        methods: {
          async loadChains() {
            try {
              this.loading = true;
              this.error = null;
              const response = await axios.get(`${this.apiBaseUrl}/api/chains`);
              this.chains = response.data;
            } catch (error) {
              this.error =
                "Failed to load chains: " +
                (error.response?.data?.error || error.message);
            } finally {
              this.loading = false;
            }
          },

          async onChainSelect() {
            if (!this.selectedChain) {
              this.wallets = [];
              this.selectedWallet = null;
              this.activities = null;
              return;
            }
            await this.loadWallets();
          },

          async loadWallets() {
            try {
              this.loading = true;
              this.error = null;
              this.selectedWallet = null;
              this.activities = null;

              const response = await axios.get(
                `${this.apiBaseUrl}/api/chain/${this.selectedChain.ChainId}/wallets`,
              );
              this.wallets = response.data;
            } catch (error) {
              this.error =
                "Failed to load wallets: " +
                (error.response?.data?.error || error.message);
            } finally {
              this.loading = false;
            }
          },

          async selectWallet(wallet) {
            this.selectedWallet = wallet;
            this.activities = null;
            await this.loadActivities();
          },

          async loadActivities() {
            if (!this.selectedChain || !this.selectedWallet) return;

            try {
              this.loading = true;
              this.error = null;

              const response = await axios.get(
                `${this.apiBaseUrl}/api/uniswapv3/${this.selectedChain.ChainId}/${this.selectedWallet.address}`,
              );
              this.activities = response.data;
            } catch (error) {
              this.error =
                "Failed to load activities: " +
                (error.response?.data?.error || error.message);
            } finally {
              this.loading = false;
            }
          },

          showActivityDetails(activity) {
            this.selectedActivity = activity;
          },

          closeActivityDetails() {
            this.selectedActivity = null;
          },

          formatAmount(amount) {
            const num = parseFloat(amount);
            if (num < 0) {
              return `-$${Math.abs(num).toFixed(2)}`;
            }
            return `$${num.toFixed(2)}`;
          },

          getAmountClass(amount) {
            const num = parseFloat(amount);
            if (num > 0) return "positive";
            if (num < 0) return "negative";
            return "";
          },

          formatDate(dateString) {
            const date = new Date(dateString);
            const currentYear = new Date().getFullYear();
            const dateYear = date.getFullYear();

            const hours = date.getHours().toString().padStart(2, "0");
            const minutes = date.getMinutes().toString().padStart(2, "0");
            const seconds = date.getSeconds().toString().padStart(2, "0");
            const timeString = `${hours}:${minutes}:${seconds}`;

            if (dateYear === currentYear) {
              const monthNames = [
                "January",
                "February",
                "March",
                "April",
                "May",
                "June",
                "July",
                "August",
                "September",
                "October",
                "November",
                "December",
              ];
              const monthName = monthNames[date.getMonth()];
              const day = date.getDate();
              return `${monthName} ${day}, ${timeString}`;
            } else {
              const day = date.getDate().toString().padStart(2, "0");
              const month = (date.getMonth() + 1).toString().padStart(2, "0");
              const year = dateYear;
              return `${day}.${month}.${year} ${timeString}`;
            }
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
